(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))o(a);new MutationObserver(a=>{for(const d of a)if(d.type==="childList")for(const i of d.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function t(a){const d={};return a.integrity&&(d.integrity=a.integrity),a.referrerPolicy&&(d.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?d.credentials="include":a.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function o(a){if(a.ep)return;a.ep=!0;const d=t(a);fetch(a.href,d)}})();function de(e){const n=new Date(e);return n.setHours(0,0,0,0),n}function ie(e){const n=new Date(e);n.setHours(0,0,0,0);const o=(n.getDay()+6)%7;return n.setDate(n.getDate()-o),n}function H(e){return e<10?`0${e}`:String(e)}function re(e){const n=H(e.getDate()),t=H(e.getMonth()+1),o=e.getFullYear(),a=H(e.getHours()),d=H(e.getMinutes());return`${n}/${t}/${o} ${a}:${d}`}function se(e,n){const t=Math.max(0,n.getTime()-e.getTime()),o=Math.floor(t/6e4),a=Math.floor(o/60),d=o%60;return`${a} hours ${d} minutes ago`}const R="todo-store-v1";let m=W(),T=!1,S=!1;const J=[];function C(){for(const e of J)e()}function ce(e){return J.push(e),()=>{const n=J.indexOf(e);n>=0&&J.splice(n,1)}}function y(){return new Date().toISOString()}function B(){return m}function V(e){for(const n of e.rows)n.type==="header"&&n.repeat!=="none"&&(n.repeat="none"),typeof n.indent!="number"||!isFinite(n.indent)||n.indent<0?n.indent=0:n.indent=Math.max(0,Math.floor(n.indent));return e}function W(){const e=localStorage.getItem(R);if(!e){const t={version:1,rows:[]};return localStorage.setItem(R,JSON.stringify(t)),t}try{const t=JSON.parse(e);if(t&&t.version===1&&Array.isArray(t.rows))return V(t)}catch{}const n={version:1,rows:[]};return localStorage.setItem(R,JSON.stringify(n)),n}function w(){if(T){S=!0;return}localStorage.setItem(R,JSON.stringify(m))}function D(){if(T){S=!0;return}m.lastEditedAt=y()}function Q(){m=W(),C()}function K(e=new Date){const n=de(e).getTime(),t=ie(e).getTime();let o=!1;for(const a of m.rows){if(a.type!=="todo"||!a.done||!a.lastCompletedAt)continue;const d=new Date(a.lastCompletedAt).getTime();a.repeat==="daily"?d<n&&(a.done=!1,a.updatedAt=y(),o=!0):a.repeat==="weekly"&&d<t&&(a.done=!1,a.updatedAt=y(),o=!0)}return Z()&&(o=!0),o&&(w(),C()),o}function le(e,n,t){const o=crypto.randomUUID(),a=y(),d={id:o,type:e,text:n.trim(),indent:0,repeat:e==="header"?"none":t,done:!1,createdAt:a,updatedAt:a};return m.rows.push(d),D(),w(),C(),d}function X(e,n){const t=m.rows.find(a=>a.id===e);if(!t)return;const o=n.trim();o.length!==0&&(t.text=o,t.updatedAt=y(),D(),w(),C())}function ue(e,n){const t=m.rows.find(o=>o.id===e);if(t){if(t.type==="header"){t.repeat!=="none"&&(t.repeat="none",t.updatedAt=y(),D(),w(),C());return}t.repeat=n,t.updatedAt=y(),D(),w(),C()}}function F(e,n){const t=m.rows.find(a=>a.id===e);if(!t)return;const o=Math.max(0,Math.floor((t.indent??0)+n));o!==t.indent&&(t.indent=o,t.updatedAt=y(),Z(),D(),w(),C())}function P(e){var o;const n=((o=m.rows[e])==null?void 0:o.indent)??0;let t=e+1;for(;t<m.rows.length&&(m.rows[t].indent??0)>n;)t++;return t}function fe(e,n,t){const o=P(e);for(let a=e+1;a<o;a++){const d=m.rows[a];d.type==="todo"&&d.done!==n&&(d.done=n,n?d.lastCompletedAt=t:delete d.lastCompletedAt,d.updatedAt=t)}}function Z(){let e=!1;const n=y();for(let t=0;t<m.rows.length;t++){const o=m.rows[t];if(o.type!=="todo")continue;const a=P(t);let d=!1,i=!0;for(let h=t+1;h<a;h++){const E=m.rows[h];if(E.type==="todo"&&(d=!0,!E.done)){i=!1;break}}d&&o.done!==i&&(o.done=i,i?o.lastCompletedAt=n:delete o.lastCompletedAt,o.updatedAt=n,e=!0)}return e}function pe(e){var a;let n=!1,t=((a=m.rows[e])==null?void 0:a.indent)??0;const o=y();for(let d=e-1;d>=0;){for(;d>=0&&m.rows[d].indent>=t;)d--;if(d<0)break;const i=m.rows[d],h=P(d);let E=!1,c=!0;for(let r=d+1;r<h;r++){const s=m.rows[r];if(s.type==="todo"&&(E=!0,!s.done)){c=!1;break}}i.type==="todo"&&E&&i.done!==c&&(i.done=c,c?i.lastCompletedAt=o:delete i.lastCompletedAt,i.updatedAt=o,n=!0),t=i.indent,d--}return n}function me(e,n){const t=m.rows.findIndex(d=>d.id===e&&d.type==="todo");if(t===-1)return;const o=m.rows[t],a=y();o.done=n,n?o.lastCompletedAt=a:delete o.lastCompletedAt,o.updatedAt=a,fe(t,n,a),pe(t),D(),w(),C()}function ee(e){const n=m.rows.findIndex(t=>t.id===e);n!==-1&&(m.rows.splice(n,1),D(),w(),C())}function he(){return JSON.stringify(m,null,2)}function ge(e){try{const n=JSON.parse(e);if(!n||n.version!==1||!Array.isArray(n.rows))return!1;for(const t of n.rows)if(!t.id||!t.type||typeof t.text!="string"||t.type!=="header"&&t.type!=="todo"||t.repeat!=="none"&&t.repeat!=="daily"&&t.repeat!=="weekly")return!1;return m=V(n),w(),C(),!0}catch{return!1}}function be(e){T=e}function Ee(){if(!S){T=!1;return}m.lastEditedAt=y(),T=!1,S=!1,w(),C()}function ve(){Q(),S=!1}function z(){return S}function xe(e,n){const t=m.rows.findIndex(E=>E.id===e);if(t===-1)return;const o=P(t),a=o-t,d=m.rows.length;let i=Math.max(0,Math.min(d,n));if(i>t&&i<=o)return;const h=m.rows.splice(t,a);t<i&&(i-=a),m.rows.splice(i,0,...h),D(),w(),C()}function Ce(e){const n=document.createElement("div");n.className="controls";const t=document.createElement("select");t.setAttribute("aria-label","Row type");const o=document.createElement("option");o.value="header",o.textContent="Header";const a=document.createElement("option");a.value="todo",a.textContent="Todo",t.appendChild(a),t.appendChild(o);const d=document.createElement("input");d.type="text",d.placeholder="Text...",d.setAttribute("aria-label","Row text");const i=document.createElement("select");i.setAttribute("aria-label","Repeat");for(const p of["daily","weekly","none"]){const u=document.createElement("option");u.value=p,u.textContent=p,i.appendChild(u)}function h(){const p=t.value==="header";i.value=p?"none":i.value||"none",i.disabled=p}t.addEventListener("change",h),h();const E=document.createElement("button");E.textContent="Add",E.setAttribute("aria-label","Add new row"),E.addEventListener("click",()=>{var l;const p=t.value,u=d.value.trim(),f=i.value;u&&((l=e.onBeforeMutate)==null||l.call(e),le(p,u,f),d.value="",d.focus())});const c=document.createElement("button");c.className="secondary",c.textContent="Export JSON",c.setAttribute("aria-label","Export data as JSON"),c.addEventListener("click",()=>{const p=he(),u=new Blob([p],{type:"application/json"}),f=URL.createObjectURL(u),l=document.createElement("a");l.href=f,l.download="todo-store-v1.json",document.body.appendChild(l),l.click(),l.remove(),URL.revokeObjectURL(f)});const r=document.createElement("button");r.className="secondary",r.textContent="Import JSON",r.setAttribute("aria-label","Import data from JSON");const s=document.createElement("input");return s.type="file",s.accept=".json,application/json",s.classList.add("hidden"),s.addEventListener("change",()=>{var f;const p=(f=s.files)==null?void 0:f[0];if(!p)return;const u=new FileReader;u.onload=()=>{var g;const l=String(u.result??"");if(!l||!confirm("Import will replace current data. Continue?"))return;(g=e.onBeforeMutate)==null||g.call(e),ge(l)||alert("Invalid JSON format.")},u.readAsText(p),s.value=""}),r.addEventListener("click",()=>s.click()),n.appendChild(t),n.appendChild(d),n.appendChild(i),n.appendChild(E),n.appendChild(c),n.appendChild(r),n.appendChild(s),n}function ye(e){const n="drop-before",t="drop-after",o="drop-invalid";let a=null;function d(i,h){const E=i.querySelector(".drag-handle");function c(r){i.setAttribute("draggable",r?"true":"false")}if(c(!1),E){const r=p=>c(!0),s=()=>c(!1);E.addEventListener("mousedown",r),E.addEventListener("touchstart",r,{passive:!0}),document.addEventListener("mouseup",s),document.addEventListener("touchend",s),document.addEventListener("touchcancel",s)}else c(!1);i.addEventListener("dragstart",r=>{var s;if(i.getAttribute("draggable")!=="true"){try{r.preventDefault()}catch{}return}a=h,i.classList.add("dragging");try{(s=r.dataTransfer)==null||s.setData("text/plain",h)}catch{}r.dataTransfer&&(r.dataTransfer.effectAllowed="move")}),i.addEventListener("dragend",()=>{i.classList.remove("dragging"),i.classList.remove(n,t,o),a=null,c(!1)}),i.addEventListener("dragover",r=>{var g;if(!a)return;r.preventDefault();const s=i.getBoundingClientRect(),p=r.clientY-s.top<s.height/2;i.classList.toggle(n,p),i.classList.toggle(t,!p);const u=B(),f=u.rows.findIndex(v=>v.id===a),l=u.rows.findIndex(v=>v.id===h);let b=!1;if(f!==-1&&l!==-1){const v=((g=u.rows[f])==null?void 0:g.indent)??0;let L=f+1;for(;L<u.rows.length&&(u.rows[L].indent??0)>v;)L++;const I=L,N=p?l:l+1;b=N>f&&N<=I}i.classList.toggle(o,b),r.dataTransfer&&(r.dataTransfer.dropEffect="move")}),i.addEventListener("dragleave",()=>{i.classList.remove(n,t,o)}),i.addEventListener("drop",r=>{var N,O;if(!a)return;r.preventDefault(),i.classList.remove(n,t,o);const s=i.getBoundingClientRect(),p=r.clientY-s.top<s.height/2,u=B(),f=u.rows.findIndex(x=>x.id===a),l=u.rows.findIndex(x=>x.id===h);if(f===-1||l===-1)return;const b=p?l:l+1,g=((N=u.rows[f])==null?void 0:N.indent)??0;let v=f+1;for(;v<u.rows.length&&(u.rows[v].indent??0)>g;)v++;const L=v;b>f&&b<=L||b===f||((O=e.onBeforeMutate)==null||O.call(e),xe(a,b))})}return{enableRowDrag:d}}function _(e,n){const{mode:t,opts:o,enableRowDrag:a}=n,d=document.createElement("div");d.className="row-line";const i=document.createElement("div");i.className="row header",i.style.marginLeft=`${e.indent?e.indent*24:0}px`;const h=document.createElement("div");if(h.textContent=e.text,i.appendChild(h),t==="edit"){const E=document.createElement("div");E.className="indent-group";const c=document.createElement("button");c.className="icon icon-left",c.textContent="<",c.title="Outdent (Shift+Tab)",c.setAttribute("aria-label",`Outdent header: ${e.text}`),c.disabled=(e.indent??0)===0,c.addEventListener("click",()=>{var l;(l=o.onBeforeMutate)==null||l.call(o),F(e.id,-1)});const r=document.createElement("button");r.className="icon icon-right",r.textContent=">",r.title="Indent (Tab)",r.setAttribute("aria-label",`Indent header: ${e.text}`),r.addEventListener("click",()=>{var l;(l=o.onBeforeMutate)==null||l.call(o),F(e.id,1)}),E.appendChild(c),E.appendChild(r),d.appendChild(E);const s=document.createElement("div");s.className="drag-handle",s.title="Drag to reorder",s.setAttribute("aria-label",`Drag to reorder: ${e.text}`),s.textContent="â˜°",d.appendChild(s);const p=document.createElement("div");p.className="actions";const u=document.createElement("button");u.className="secondary",u.textContent="Edit",u.setAttribute("aria-label",`Edit header: ${e.text}`),u.addEventListener("click",()=>{var b;const l=prompt("Edit header text:",e.text);if(l!=null){const g=l.trim();g&&((b=o.onBeforeMutate)==null||b.call(o),X(e.id,g))}});const f=document.createElement("button");f.className="icon danger",f.textContent="ðŸ—‘ï¸Ž",f.title="Delete",f.setAttribute("aria-label",`Delete header: ${e.text}`),f.addEventListener("click",()=>{var l;confirm("Delete this header?")&&((l=o.onBeforeMutate)==null||l.call(o),ee(e.id))}),p.appendChild(u),p.appendChild(f),i.appendChild(p),a(d,e.id)}return d.appendChild(i),d}function Y(e,n){const{mode:t,opts:o,enableRowDrag:a}=n,d=document.createElement("div");d.className="row-line";const i=document.createElement("div");if(i.className="row todo",i.style.marginLeft=`${e.indent?e.indent*24:0}px`,t==="read"){const c=document.createElement("input");c.type="checkbox",c.className="checkbox",c.checked=e.done,c.setAttribute("aria-label",`Toggle todo: ${e.text}`),c.addEventListener("change",()=>{var r;(r=o.onBeforeMutate)==null||r.call(o),me(e.id,c.checked)}),i.appendChild(c)}else{const c=document.createElement("div");c.className="checkbox-spacer",i.appendChild(c)}const h=document.createElement("div");h.className="text";const E=document.createElement("span");if(E.textContent=e.text,h.appendChild(E),e.repeat!=="none"){const c=document.createElement("span");c.className=`badge ${e.repeat}`,c.textContent=e.repeat,c.setAttribute("aria-label",`Repeat: ${e.repeat}`),h.appendChild(c)}if(i.appendChild(h),t==="edit"){const c=document.createElement("div");c.className="indent-group";const r=document.createElement("button");r.className="icon icon-left",r.textContent="<",r.title="Outdent (Shift+Tab)",r.setAttribute("aria-label",`Outdent todo: ${e.text}`),r.disabled=(e.indent??0)===0,r.addEventListener("click",()=>{var g;(g=o.onBeforeMutate)==null||g.call(o),F(e.id,-1)});const s=document.createElement("button");s.className="icon icon-right",s.textContent=">",s.title="Indent (Tab)",s.setAttribute("aria-label",`Indent todo: ${e.text}`),s.addEventListener("click",()=>{var g;(g=o.onBeforeMutate)==null||g.call(o),F(e.id,1)}),c.appendChild(r),c.appendChild(s),d.appendChild(c);const p=document.createElement("div");p.className="drag-handle",p.title="Drag to reorder",p.setAttribute("aria-label",`Drag to reorder: ${e.text}`),p.textContent="â˜°",d.appendChild(p);const u=document.createElement("div");u.className="actions";const f=document.createElement("select");for(const g of["none","daily","weekly"]){const v=document.createElement("option");v.value=g,v.textContent=g,g===e.repeat&&(v.selected=!0),f.appendChild(v)}f.setAttribute("aria-label",`Change repeat for: ${e.text}`),f.addEventListener("change",()=>{var v;const g=f.value;(v=o.onBeforeMutate)==null||v.call(o),ue(e.id,g)});const l=document.createElement("button");l.className="secondary",l.textContent="Edit",l.setAttribute("aria-label",`Edit todo: ${e.text}`),l.addEventListener("click",()=>{var v;const g=prompt("Edit todo text:",e.text);if(g!=null){const L=g.trim();L&&((v=o.onBeforeMutate)==null||v.call(o),X(e.id,L))}});const b=document.createElement("button");b.className="icon danger",b.textContent="ðŸ—‘ï¸Ž",b.title="Delete",b.setAttribute("aria-label",`Delete todo: ${e.text}`),b.addEventListener("click",()=>{var g;confirm("Delete this todo?")&&((g=o.onBeforeMutate)==null||g.call(o),ee(e.id))}),u.appendChild(f),u.appendChild(l),u.appendChild(b),i.appendChild(u),a(d,e.id)}else{const c=document.createElement("div");i.appendChild(c)}return d.appendChild(i),d}function Le(){const e=B(),n=document.getElementById("last-edited");if(!n)return;const t=e.lastEditedAt?re(new Date(e.lastEditedAt)):"Never",o=e.lastEditedAt?` (${se(new Date(e.lastEditedAt),new Date)})`:"";n.textContent=`Last edited at: ${t}${o}`}function Ae(e,n={}){let t="read";function o(){e.innerHTML="",t==="edit"?e.classList.add("mode-edit"):e.classList.remove("mode-edit");const a=document.createElement("div");a.className="topbar";const d=document.createElement("div");d.className="left";const i=document.createElement("div");i.className="right";const h=document.createElement("button");if(h.className="secondary",h.setAttribute("aria-label","Toggle edit mode"),(()=>{t==="read"?h.textContent="Edit mode":h.textContent=z()?"Save Changes":"Exit Edit Mode"})(),h.addEventListener("click",()=>{t==="read"?(be(!0),t="edit"):(Ee(),t="read"),o()}),t==="edit"){const r=document.createElement("button");r.className="secondary",r.textContent="Undo",r.setAttribute("aria-label","Undo changes since entering edit mode"),r.disabled=!z(),r.addEventListener("click",()=>{r.disabled||(ve(),o())}),i.appendChild(r)}i.appendChild(h),a.appendChild(d),a.appendChild(i);const c=document.createElement("div");if(c.className="card",t==="edit"&&c.appendChild(Ce(n)),B().rows.length===0){const r=document.createElement("div");r.className="empty",r.textContent="No items yet. Toggle Edit mode to add headers and todos.",c.appendChild(r)}else{const r=document.createElement("div");r.className="list";const s=B().rows,{enableRowDrag:p}=ye(n),u={mode:t,opts:n,enableRowDrag:p};for(let f=0;f<s.length;f++){const l=s[f],b=l.indent?l.indent:0,g=f>0&&s[f-1].indent?s[f-1].indent:0,v=f<s.length-1&&s[f+1].indent?s[f+1].indent:0,L=v>b,I=b>0,N=I&&g<b,O=I&&v<b;if(L){const x=document.createElement("div");x.className="group-block",x.style.marginLeft=`${b?b*24:0}px`;const U=l.type==="header"?_(l,u):Y(l,u);U.classList.add("group-parent");const G=U.querySelector(".row");G&&(G.style.marginLeft="0px"),x.appendChild(U);let A=f+1;for(;A<s.length&&(s[A].indent?s[A].indent:0)>b;){const k=s[A],$=k.indent?k.indent:0,te=s[A-1].indent?s[A-1].indent:0,ne=A<s.length-1&&s[A+1].indent?s[A+1].indent:0,j=$>0,oe=j&&te<$,ae=j&&ne<$,M=k.type==="header"?_(k,u):Y(k,u);j&&M.classList.add("group-child"),oe&&M.classList.add("group-first"),ae&&M.classList.add("group-last");const q=M.querySelector(".row");q&&(q.style.marginLeft=`${($-b)*24}px`),x.appendChild(M),A++}r.appendChild(x),f=A-1}else{const x=l.type==="header"?_(l,u):Y(l,u);I&&x.classList.add("group-child"),N&&x.classList.add("group-first"),O&&x.classList.add("group-last"),r.appendChild(x)}}c.appendChild(r)}e.appendChild(a),e.appendChild(c)}return{render:o,updateRelativeTimer:Le}}window.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("app");if(!e)return;let n=!1;const t=Ae(e,{onBeforeMutate:()=>{n&&(K(new Date),n=!1)}});K(new Date),t.render(),ce(()=>t.render()),window.addEventListener("storage",a=>{a.key===R&&Q()});let o=Date.now();setInterval(()=>{const a=Date.now();a-o>6*60*60*1e3&&(n=!0),o=a,t.updateRelativeTimer()},6e4)});
