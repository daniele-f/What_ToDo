(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))d(a);new MutationObserver(a=>{for(const r of a)if(r.type==="childList")for(const c of r.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&d(c)}).observe(document,{childList:!0,subtree:!0});function t(a){const r={};return a.integrity&&(r.integrity=a.integrity),a.referrerPolicy&&(r.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?r.credentials="include":a.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function d(a){if(a.ep)return;a.ep=!0;const r=t(a);fetch(a.href,r)}})();const me="modulepreload",pe=function(o,e){return new URL(o,e).href},Q={},he=function(e,t,d){let a=Promise.resolve();if(t&&t.length>0){const c=document.getElementsByTagName("link"),m=document.querySelector("meta[property=csp-nonce]"),A=(m==null?void 0:m.nonce)||(m==null?void 0:m.getAttribute("nonce"));a=Promise.allSettled(t.map(w=>{if(w=pe(w,d),w in Q)return;Q[w]=!0;const N=w.endsWith(".css"),O=N?'[rel="stylesheet"]':"";if(!!d)for(let I=c.length-1;I>=0;I--){const T=c[I];if(T.href===w&&(!N||T.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${w}"]${O}`))return;const L=document.createElement("link");if(L.rel=N?"stylesheet":me,N||(L.as="script"),L.crossOrigin="",L.href=w,A&&L.setAttribute("nonce",A),document.head.appendChild(L),N)return new Promise((I,T)=>{L.addEventListener("load",I),L.addEventListener("error",()=>T(new Error(`Unable to preload CSS for ${w}`)))})}))}function r(c){const m=new Event("vite:preloadError",{cancelable:!0});if(m.payload=c,window.dispatchEvent(m),!m.defaultPrevented)throw c}return a.then(c=>{for(const m of c||[])m.status==="rejected"&&r(m.reason);return e().catch(r)})};function Ee(o){const e=new Date(o);return e.setHours(0,0,0,0),e}function ge(o){const e=new Date(o);e.setHours(0,0,0,0);const d=(e.getDay()+6)%7;return e.setDate(e.getDate()-d),e}function U(o){return o<10?`0${o}`:String(o)}function X(o){const e=U(o.getDate()),t=U(o.getMonth()+1),d=o.getFullYear(),a=U(o.getHours()),r=U(o.getMinutes());return`${e}/${t}/${d} ${a}:${r}`}function Z(o,e){const t=Math.max(0,e.getTime()-o.getTime()),d=Math.floor(t/6e4),a=Math.floor(d/60),r=d%60;return`${a} hours ${r} minutes ago`}const _="todo-store-v1";let f=ne();const F=[];function D(){for(const o of F)o()}function ee(o){return F.push(o),()=>{const e=F.indexOf(o);e>=0&&F.splice(e,1)}}function k(){return new Date().toISOString()}function $(){return f}function te(o){for(const e of o.rows)e.type==="header"&&e.repeat!=="none"&&(e.repeat="none"),typeof e.indent!="number"||!isFinite(e.indent)||e.indent<0?e.indent=0:e.indent=Math.max(0,Math.floor(e.indent));return o}function ne(){const o=localStorage.getItem(_);if(!o){const t={version:1,rows:[]};return localStorage.setItem(_,JSON.stringify(t)),t}try{const t=JSON.parse(o);if(t&&t.version===1&&Array.isArray(t.rows))return te(t)}catch{}const e={version:1,rows:[]};return localStorage.setItem(_,JSON.stringify(e)),e}function B(){localStorage.setItem(_,JSON.stringify(f))}function R(){f.lastEditedAt=k()}function oe(){f=ne(),D()}function q(o=new Date){const e=Ee(o).getTime(),t=ge(o).getTime();let d=!1;for(const a of f.rows){if(a.type!=="todo"||!a.done||!a.lastCompletedAt)continue;const r=new Date(a.lastCompletedAt).getTime();a.repeat==="daily"?r<e&&(a.done=!1,a.updatedAt=k(),d=!0):a.repeat==="weekly"&&r<t&&(a.done=!1,a.updatedAt=k(),d=!0)}return re()&&(d=!0),d&&(B(),D()),d}function be(o,e,t){const d=crypto.randomUUID(),a=k(),r={id:d,type:o,text:e.trim(),indent:0,repeat:o==="header"?"none":t,done:!1,createdAt:a,updatedAt:a};return f.rows.push(r),R(),B(),D(),r}function G(o,e){const t=f.rows.find(a=>a.id===o);if(!t)return;const d=e.trim();d.length!==0&&(t.text=d,t.updatedAt=k(),R(),B(),D())}function ae(o,e){const t=f.rows.find(d=>d.id===o);if(t){if(t.type==="header"){t.repeat!=="none"&&(t.repeat="none",t.updatedAt=k(),R(),B(),D());return}t.repeat=e,t.updatedAt=k(),R(),B(),D()}}function H(o,e){const t=f.rows.find(a=>a.id===o);if(!t)return;const d=Math.max(0,Math.floor((t.indent??0)+e));d!==t.indent&&(t.indent=d,t.updatedAt=k(),re(),R(),B(),D())}function Y(o){var d;const e=((d=f.rows[o])==null?void 0:d.indent)??0;let t=o+1;for(;t<f.rows.length&&(f.rows[t].indent??0)>e;)t++;return t}function ve(o,e,t){const d=Y(o);for(let a=o+1;a<d;a++){const r=f.rows[a];r.type==="todo"&&r.done!==e&&(r.done=e,e?r.lastCompletedAt=t:delete r.lastCompletedAt,r.updatedAt=t)}}function re(){let o=!1;const e=k();for(let t=0;t<f.rows.length;t++){const d=f.rows[t];if(d.type!=="todo")continue;const a=Y(t);let r=!1,c=!0;for(let m=t+1;m<a;m++){const A=f.rows[m];if(A.type==="todo"&&(r=!0,!A.done)){c=!1;break}}r&&d.done!==c&&(d.done=c,c?d.lastCompletedAt=e:delete d.lastCompletedAt,d.updatedAt=e,o=!0)}return o}function Ce(o){var a;let e=!1,t=((a=f.rows[o])==null?void 0:a.indent)??0;const d=k();for(let r=o-1;r>=0;){for(;r>=0&&f.rows[r].indent>=t;)r--;if(r<0)break;const c=f.rows[r],m=Y(r);let A=!1,w=!0;for(let N=r+1;N<m;N++){const O=f.rows[N];if(O.type==="todo"&&(A=!0,!O.done)){w=!1;break}}c.type==="todo"&&A&&c.done!==w&&(c.done=w,w?c.lastCompletedAt=d:delete c.lastCompletedAt,c.updatedAt=d,e=!0),t=c.indent,r--}return e}function de(o,e){const t=f.rows.findIndex(r=>r.id===o&&r.type==="todo");if(t===-1)return;const d=f.rows[t],a=k();d.done=e,e?d.lastCompletedAt=a:delete d.lastCompletedAt,d.updatedAt=a,ve(t,e,a),Ce(t),R(),B(),D()}function z(o){const e=f.rows.findIndex(t=>t.id===o);e!==-1&&(f.rows.splice(e,1),R(),B(),D())}function ie(){return JSON.stringify(f,null,2)}function ce(o){try{const e=JSON.parse(o);if(!e||e.version!==1||!Array.isArray(e.rows))return!1;for(const t of e.rows)if(!t.id||!t.type||typeof t.text!="string"||t.type!=="header"&&t.type!=="todo"||t.repeat!=="none"&&t.repeat!=="daily"&&t.repeat!=="weekly")return!1;return f=te(e),B(),D(),!0}catch{return!1}}function le(o,e){const t=f.rows.findIndex(A=>A.id===o);if(t===-1)return;const d=Y(t),a=d-t,r=f.rows.length;let c=Math.max(0,Math.min(r,e));if(c>t&&c<=d)return;const m=f.rows.splice(t,a);t<c&&(c-=a),f.rows.splice(c,0,...m),R(),B(),D()}const ye=Object.freeze(Object.defineProperty({__proto__:null,STORAGE_KEY:_,addRow:be,changeIndent:H,deleteRow:z,editRowText:G,exportJSON:ie,getStore:$,importJSON:ce,moveRow:le,recomputeResets:q,reloadFromLocalStorage:oe,setRowRepeat:ae,subscribe:ee,toggleTodoDone:de},Symbol.toStringTag,{value:"Module"}));function xe(o,e={}){let t="read";function d(){const r=$();o.innerHTML="";const c=document.createElement("div");c.className="topbar";const m=document.createElement("div");m.className="left";const A=document.createElement("div");A.className="meta";const w=r.lastEditedAt?X(new Date(r.lastEditedAt)):"Never",N=r.lastEditedAt?` (${Z(new Date(r.lastEditedAt),new Date)})`:"";A.id="last-edited",A.textContent=`Last edited at: ${w}${N}`,m.appendChild(A);const O=document.createElement("div");O.className="right";const J=document.createElement("button");J.textContent="Refresh",J.setAttribute("aria-label","Refresh page"),J.addEventListener("click",()=>{location.reload()});const L=document.createElement("button");L.className="secondary",L.setAttribute("aria-label","Toggle edit mode"),(()=>{L.textContent=t==="read"?"Edit mode":"Save"})(),L.addEventListener("click",()=>{t=t==="read"?"edit":"read",d()}),m.appendChild(J),O.appendChild(L),c.appendChild(m),c.appendChild(O);const T=document.createElement("div");if(T.className="card",t==="edit"&&T.appendChild(se()),$().rows.length===0){const n=document.createElement("div");n.className="empty",n.textContent="No items yet. Toggle Edit mode to add headers and todos.",T.appendChild(n)}else{const n=document.createElement("div");n.className="list";for(const p of $().rows)p.type==="header"?n.appendChild(ue(p)):n.appendChild(fe(p));T.appendChild(n)}o.appendChild(c),o.appendChild(T);const P="drop-before",j="drop-after";let M=null;function K(n,p){n.setAttribute("draggable","true"),n.addEventListener("dragstart",s=>{var b;M=p,n.classList.add("dragging");try{(b=s.dataTransfer)==null||b.setData("text/plain",p)}catch{}s.dataTransfer&&(s.dataTransfer.effectAllowed="move")}),n.addEventListener("dragend",()=>{n.classList.remove("dragging"),n.classList.remove(P,j),M=null}),n.addEventListener("dragover",s=>{if(!M)return;s.preventDefault();const b=n.getBoundingClientRect(),v=s.clientY-b.top<b.height/2;n.classList.toggle(P,v),n.classList.toggle(j,!v),s.dataTransfer&&(s.dataTransfer.dropEffect="move")}),n.addEventListener("dragleave",()=>{n.classList.remove(P,j)}),n.addEventListener("drop",s=>{var g;if(!M)return;s.preventDefault(),n.classList.remove(P,j);const b=n.getBoundingClientRect(),v=s.clientY-b.top<b.height/2,i=$(),h=i.rows.findIndex(u=>u.id===M),C=i.rows.findIndex(u=>u.id===p);if(h===-1||C===-1)return;let y=v?C:C+1;(g=e.onBeforeMutate)==null||g.call(e),le(M,y)})}function se(){const n=document.createElement("div");n.className="controls";const p=document.createElement("select");p.setAttribute("aria-label","Row type");const s=document.createElement("option");s.value="header",s.textContent="Header";const b=document.createElement("option");b.value="todo",b.textContent="Todo",p.appendChild(b),p.appendChild(s);const v=document.createElement("input");v.type="text",v.placeholder="Text...",v.setAttribute("aria-label","Row text");const i=document.createElement("select");i.setAttribute("aria-label","Repeat");for(const E of["daily","weekly","none"]){const l=document.createElement("option");l.value=E,l.textContent=E,i.appendChild(l)}function h(){const E=p.value==="header";i.value=E?"none":i.value||"none",i.disabled=E}p.addEventListener("change",h),h();const C=document.createElement("button");C.textContent="Add",C.setAttribute("aria-label","Add new row"),C.addEventListener("click",()=>{var S;const E=p.value,l=v.value.trim(),x=i.value;l&&((S=e.onBeforeMutate)==null||S.call(e),he(()=>Promise.resolve().then(()=>ye),void 0,import.meta.url).then(W=>W.addRow(E,l,x)),v.value="",v.focus())});const y=document.createElement("button");y.className="secondary",y.textContent="Export JSON",y.setAttribute("aria-label","Export data as JSON"),y.addEventListener("click",()=>{const E=ie(),l=new Blob([E],{type:"application/json"}),x=URL.createObjectURL(l),S=document.createElement("a");S.href=x,S.download="todo-store-v1.json",document.body.appendChild(S),S.click(),S.remove(),URL.revokeObjectURL(x)});const g=document.createElement("button");g.className="secondary",g.textContent="Import JSON",g.setAttribute("aria-label","Import data from JSON");const u=document.createElement("input");return u.type="file",u.accept=".json,application/json",u.classList.add("hidden"),u.addEventListener("change",()=>{var x;const E=(x=u.files)==null?void 0:x[0];if(!E)return;const l=new FileReader;l.onload=()=>{var V;const S=String(l.result??"");if(!S||!confirm("Import will replace current data. Continue?"))return;(V=e.onBeforeMutate)==null||V.call(e),ce(S)||alert("Invalid JSON format.")},l.readAsText(E),u.value=""}),g.addEventListener("click",()=>u.click()),n.appendChild(p),n.appendChild(v),n.appendChild(i),n.appendChild(C),n.appendChild(y),n.appendChild(g),n.appendChild(u),n}function ue(n){const p=document.createElement("div");p.className="row-line";const s=document.createElement("div");s.className="row header",s.style.marginLeft=`${n.indent?n.indent*24:0}px`;const b=document.createElement("div");if(b.textContent=n.text,s.appendChild(b),t==="edit"){const v=document.createElement("div");v.className="indent-group";const i=document.createElement("button");i.className="icon icon-left",i.textContent="<",i.title="Outdent (Shift+Tab)",i.setAttribute("aria-label",`Outdent header: ${n.text}`),i.disabled=(n.indent??0)===0,i.addEventListener("click",()=>{var u;(u=e.onBeforeMutate)==null||u.call(e),H(n.id,-1)});const h=document.createElement("button");h.className="icon icon-right",h.textContent=">",h.title="Indent (Tab)",h.setAttribute("aria-label",`Indent header: ${n.text}`),h.addEventListener("click",()=>{var u;(u=e.onBeforeMutate)==null||u.call(e),H(n.id,1)}),v.appendChild(i),v.appendChild(h),p.appendChild(v);const C=document.createElement("div");C.className="actions";const y=document.createElement("button");y.className="secondary",y.textContent="Edit",y.setAttribute("aria-label",`Edit header: ${n.text}`),y.addEventListener("click",()=>{var E;const u=prompt("Edit header text:",n.text);if(u!=null){const l=u.trim();l&&((E=e.onBeforeMutate)==null||E.call(e),G(n.id,l))}});const g=document.createElement("button");g.className="icon danger",g.textContent="🗑️",g.title="Delete",g.setAttribute("aria-label",`Delete header: ${n.text}`),g.addEventListener("click",()=>{var u;confirm("Delete this header?")&&((u=e.onBeforeMutate)==null||u.call(e),z(n.id))}),C.appendChild(y),C.appendChild(g),s.appendChild(C),K(p,n.id)}return p.appendChild(s),p}function fe(n){const p=document.createElement("div");p.className="row-line";const s=document.createElement("div");if(s.className="row todo",s.style.marginLeft=`${n.indent?n.indent*24:0}px`,t==="read"){const i=document.createElement("input");i.type="checkbox",i.className="checkbox",i.checked=n.done,i.setAttribute("aria-label",`Toggle todo: ${n.text}`),i.addEventListener("change",()=>{var h;(h=e.onBeforeMutate)==null||h.call(e),de(n.id,i.checked)}),s.appendChild(i)}else{const i=document.createElement("div");i.className="checkbox-spacer",s.appendChild(i)}const b=document.createElement("div");b.className="text";const v=document.createElement("span");if(v.textContent=n.text,b.appendChild(v),n.repeat!=="none"){const i=document.createElement("span");i.className=`badge ${n.repeat}`,i.textContent=n.repeat,i.setAttribute("aria-label",`Repeat: ${n.repeat}`),b.appendChild(i)}if(s.appendChild(b),t==="edit"){const i=document.createElement("div");i.className="indent-group";const h=document.createElement("button");h.className="icon icon-left",h.textContent="<",h.title="Outdent (Shift+Tab)",h.setAttribute("aria-label",`Outdent todo: ${n.text}`),h.disabled=(n.indent??0)===0,h.addEventListener("click",()=>{var l;(l=e.onBeforeMutate)==null||l.call(e),H(n.id,-1)});const C=document.createElement("button");C.className="icon icon-right",C.textContent=">",C.title="Indent (Tab)",C.setAttribute("aria-label",`Indent todo: ${n.text}`),C.addEventListener("click",()=>{var l;(l=e.onBeforeMutate)==null||l.call(e),H(n.id,1)}),i.appendChild(h),i.appendChild(C),p.appendChild(i);const y=document.createElement("div");y.className="actions";const g=document.createElement("select");for(const l of["none","daily","weekly"]){const x=document.createElement("option");x.value=l,x.textContent=l,l===n.repeat&&(x.selected=!0),g.appendChild(x)}g.setAttribute("aria-label",`Change repeat for: ${n.text}`),g.addEventListener("change",()=>{var x;const l=g.value;(x=e.onBeforeMutate)==null||x.call(e),ae(n.id,l)});const u=document.createElement("button");u.className="secondary",u.textContent="Edit",u.setAttribute("aria-label",`Edit todo: ${n.text}`),u.addEventListener("click",()=>{var x;const l=prompt("Edit todo text:",n.text);if(l!=null){const S=l.trim();S&&((x=e.onBeforeMutate)==null||x.call(e),G(n.id,S))}});const E=document.createElement("button");E.className="icon danger",E.textContent="🗑️",E.title="Delete",E.setAttribute("aria-label",`Delete todo: ${n.text}`),E.addEventListener("click",()=>{var l;confirm("Delete this todo?")&&((l=e.onBeforeMutate)==null||l.call(e),z(n.id))}),y.appendChild(g),y.appendChild(u),y.appendChild(E),s.appendChild(y),K(p,n.id)}else{const i=document.createElement("div");s.appendChild(i)}return p.appendChild(s),p}}function a(){const r=$(),c=document.getElementById("last-edited");if(!c)return;const m=r.lastEditedAt?X(new Date(r.lastEditedAt)):"Never",A=r.lastEditedAt?` (${Z(new Date(r.lastEditedAt),new Date)})`:"";c.textContent=`Last edited at: ${m}${A}`}return{render:d,updateRelativeTimer:a}}window.addEventListener("DOMContentLoaded",()=>{const o=document.getElementById("app");if(!o)return;let e=!1;const t=xe(o,{onBeforeMutate:()=>{e&&(q(new Date),e=!1)}});q(new Date),t.render(),ee(()=>t.render()),window.addEventListener("storage",a=>{a.key===_&&oe()});let d=Date.now();setInterval(()=>{const a=Date.now();a-d>6*60*60*1e3&&(e=!0),d=a,t.updateRelativeTimer()},6e4)});
