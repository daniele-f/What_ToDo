(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))d(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const f of i.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&d(f)}).observe(document,{childList:!0,subtree:!0});function t(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function d(o){if(o.ep)return;o.ep=!0;const i=t(o);fetch(o.href,i)}})();const ae="modulepreload",ie=function(n,e){return new URL(n,e).href},q={},de=function(e,t,d){let o=Promise.resolve();if(t&&t.length>0){const f=document.getElementsByTagName("link"),l=document.querySelector("meta[property=csp-nonce]"),N=(l==null?void 0:l.nonce)||(l==null?void 0:l.getAttribute("nonce"));o=Promise.allSettled(t.map(g=>{if(g=ie(g,d),g in q)return;q[g]=!0;const R=g.endsWith(".css"),M=R?'[rel="stylesheet"]':"";if(!!d)for(let B=f.length-1;B>=0;B--){const S=f[B];if(S.href===g&&(!R||S.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${g}"]${M}`))return;const p=document.createElement("link");if(p.rel=R?"stylesheet":ae,R||(p.as="script"),p.crossOrigin="",p.href=g,N&&p.setAttribute("nonce",N),document.head.appendChild(p),R)return new Promise((B,S)=>{p.addEventListener("load",B),p.addEventListener("error",()=>S(new Error(`Unable to preload CSS for ${g}`)))})}))}function i(f){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=f,window.dispatchEvent(l),!l.defaultPrevented)throw f}return o.then(f=>{for(const l of f||[])l.status==="rejected"&&i(l.reason);return e().catch(i)})};function ce(n){const e=new Date(n);return e.setHours(0,0,0,0),e}function se(n){const e=new Date(n);e.setHours(0,0,0,0);const d=(e.getDay()+6)%7;return e.setDate(e.getDate()-d),e}function H(n){return n<10?`0${n}`:String(n)}function z(n){const e=H(n.getDate()),t=H(n.getMonth()+1),d=n.getFullYear(),o=H(n.getHours()),i=H(n.getMinutes());return`${e}/${t}/${d} ${o}:${i}`}function K(n,e){const t=Math.max(0,e.getTime()-n.getTime()),d=Math.floor(t/6e4),o=Math.floor(d/60),i=d%60;return`${o} hours ${i} minutes ago`}const $="todo-store-v1";let v=V();const P=[];function L(){for(const n of P)n()}function W(n){return P.push(n),()=>{const e=P.indexOf(n);e>=0&&P.splice(e,1)}}function D(){return new Date().toISOString()}function J(){return v}function G(n){for(const e of n.rows)e.type==="header"&&e.repeat!=="none"&&(e.repeat="none");return n}function V(){const n=localStorage.getItem($);if(!n){const t={version:1,rows:[]};return localStorage.setItem($,JSON.stringify(t)),t}try{const t=JSON.parse(n);if(t&&t.version===1&&Array.isArray(t.rows))return G(t)}catch{}const e={version:1,rows:[]};return localStorage.setItem($,JSON.stringify(e)),e}function O(){localStorage.setItem($,JSON.stringify(v))}function T(){v.lastEditedAt=D()}function Q(){v=V(),L()}function _(n=new Date){const e=ce(n).getTime(),t=se(n).getTime();let d=!1;for(const o of v.rows){if(o.type!=="todo"||!o.done||!o.lastCompletedAt)continue;const i=new Date(o.lastCompletedAt).getTime();o.repeat==="daily"?i<e&&(o.done=!1,o.updatedAt=D(),d=!0):o.repeat==="weekly"&&i<t&&(o.done=!1,o.updatedAt=D(),d=!0)}return d&&(O(),L()),d}function le(n,e,t){const d=crypto.randomUUID(),o=D(),i={id:d,type:n,text:e.trim(),repeat:n==="header"?"none":t,done:!1,createdAt:o,updatedAt:o};return v.rows.push(i),T(),O(),L(),i}function j(n,e){const t=v.rows.find(o=>o.id===n);if(!t)return;const d=e.trim();d.length!==0&&(t.text=d,t.updatedAt=D(),T(),O(),L())}function X(n,e){const t=v.rows.find(d=>d.id===n);if(t){if(t.type==="header"){t.repeat!=="none"&&(t.repeat="none",t.updatedAt=D(),T(),O(),L());return}t.repeat=e,t.updatedAt=D(),T(),O(),L()}}function Z(n,e){const t=v.rows.find(d=>d.id===n&&d.type==="todo");t&&(t.done=e,e?t.lastCompletedAt=D():delete t.lastCompletedAt,t.updatedAt=D(),T(),O(),L())}function U(n){const e=v.rows.findIndex(t=>t.id===n);e!==-1&&(v.rows.splice(e,1),T(),O(),L())}function ee(){return JSON.stringify(v,null,2)}function te(n){try{const e=JSON.parse(n);if(!e||e.version!==1||!Array.isArray(e.rows))return!1;for(const t of e.rows)if(!t.id||!t.type||typeof t.text!="string"||t.type!=="header"&&t.type!=="todo"||t.repeat!=="none"&&t.repeat!=="daily"&&t.repeat!=="weekly")return!1;return v=G(e),O(),L(),!0}catch{return!1}}const ue=Object.freeze(Object.defineProperty({__proto__:null,STORAGE_KEY:$,addRow:le,deleteRow:U,editRowText:j,exportJSON:ee,getStore:J,importJSON:te,recomputeResets:_,reloadFromLocalStorage:Q,setRowRepeat:X,subscribe:W,toggleTodoDone:Z},Symbol.toStringTag,{value:"Module"}));function fe(n,e={}){let t="read";function d(){const i=J();n.innerHTML="";const f=document.createElement("div");f.className="topbar";const l=document.createElement("div");l.className="left";const N=document.createElement("div");N.className="meta";const g=i.lastEditedAt?z(new Date(i.lastEditedAt)):"Never",R=i.lastEditedAt?` (${K(new Date(i.lastEditedAt),new Date)})`:"";N.id="last-edited",N.textContent=`Last edited at: ${g}${R}`,l.appendChild(N);const M=document.createElement("div");M.className="right";const I=document.createElement("button");I.textContent="Refresh",I.setAttribute("aria-label","Refresh page"),I.addEventListener("click",()=>{location.reload()});const p=document.createElement("button");p.className="secondary",p.setAttribute("aria-label","Toggle edit mode"),(()=>{p.textContent=t==="read"?"Edit mode":"Save"})(),p.addEventListener("click",()=>{t=t==="read"?"edit":"read",d()}),l.appendChild(I),M.appendChild(p),f.appendChild(l),f.appendChild(M);const S=document.createElement("div");if(S.className="card",t==="edit"&&S.appendChild(ne()),J().rows.length===0){const r=document.createElement("div");r.className="empty",r.textContent="No items yet. Toggle Edit mode to add headers and todos.",S.appendChild(r)}else{const r=document.createElement("div");r.className="list";for(const c of J().rows)c.type==="header"?r.appendChild(oe(c)):r.appendChild(re(c));S.appendChild(r)}n.appendChild(f),n.appendChild(S);function ne(){const r=document.createElement("div");r.className="controls";const c=document.createElement("select");c.setAttribute("aria-label","Row type");const C=document.createElement("option");C.value="header",C.textContent="Header";const x=document.createElement("option");x.value="todo",x.textContent="Todo",c.appendChild(x),c.appendChild(C);const a=document.createElement("input");a.type="text",a.placeholder="Text...",a.setAttribute("aria-label","Row text");const s=document.createElement("select");s.setAttribute("aria-label","Repeat");for(const y of["daily","weekly","none"]){const b=document.createElement("option");b.value=y,b.textContent=y,s.appendChild(b)}function h(){const y=c.value==="header";s.value=y?"none":s.value||"none",s.disabled=y}c.addEventListener("change",h),h();const E=document.createElement("button");E.textContent="Add",E.setAttribute("aria-label","Add new row"),E.addEventListener("click",()=>{var A;const y=c.value,b=a.value.trim(),k=s.value;b&&((A=e.onBeforeMutate)==null||A.call(e),de(()=>Promise.resolve().then(()=>ue),void 0,import.meta.url).then(Y=>Y.addRow(y,b,k)),a.value="",a.focus())});const u=document.createElement("button");u.className="secondary",u.textContent="Export JSON",u.setAttribute("aria-label","Export data as JSON"),u.addEventListener("click",()=>{const y=ee(),b=new Blob([y],{type:"application/json"}),k=URL.createObjectURL(b),A=document.createElement("a");A.href=k,A.download="todo-store-v1.json",document.body.appendChild(A),A.click(),A.remove(),URL.revokeObjectURL(k)});const m=document.createElement("button");m.className="secondary",m.textContent="Import JSON",m.setAttribute("aria-label","Import data from JSON");const w=document.createElement("input");return w.type="file",w.accept=".json,application/json",w.style.display="none",w.addEventListener("change",()=>{var k;const y=(k=w.files)==null?void 0:k[0];if(!y)return;const b=new FileReader;b.onload=()=>{var F;const A=String(b.result??"");if(!A||!confirm("Import will replace current data. Continue?"))return;(F=e.onBeforeMutate)==null||F.call(e),te(A)||alert("Invalid JSON format.")},b.readAsText(y),w.value=""}),m.addEventListener("click",()=>w.click()),r.appendChild(c),r.appendChild(a),r.appendChild(s),r.appendChild(E),r.appendChild(u),r.appendChild(m),r.appendChild(w),r}function oe(r){const c=document.createElement("div");c.className="row header";const C=document.createElement("div");if(C.textContent=r.text,c.appendChild(C),t==="edit"){const x=document.createElement("div");x.className="actions";const a=document.createElement("button");a.className="secondary",a.textContent="Edit",a.setAttribute("aria-label",`Edit header: ${r.text}`),a.addEventListener("click",()=>{var E;const h=prompt("Edit header text:",r.text);if(h!=null){const u=h.trim();u&&((E=e.onBeforeMutate)==null||E.call(e),j(r.id,u))}});const s=document.createElement("button");s.className="danger",s.textContent="Delete",s.setAttribute("aria-label",`Delete header: ${r.text}`),s.addEventListener("click",()=>{var h;confirm("Delete this header?")&&((h=e.onBeforeMutate)==null||h.call(e),U(r.id))}),x.appendChild(a),x.appendChild(s),c.appendChild(x)}return c}function re(r){const c=document.createElement("div");if(c.className="row todo",t==="read"){const a=document.createElement("input");a.type="checkbox",a.className="checkbox",a.checked=r.done,a.setAttribute("aria-label",`Toggle todo: ${r.text}`),a.addEventListener("change",()=>{var s;(s=e.onBeforeMutate)==null||s.call(e),Z(r.id,a.checked)}),c.appendChild(a)}else{const a=document.createElement("div");a.style.width="18px",c.appendChild(a)}const C=document.createElement("div");C.className="text";const x=document.createElement("span");if(x.textContent=r.text,C.appendChild(x),r.repeat!=="none"){const a=document.createElement("span");a.className=`badge ${r.repeat}`,a.textContent=r.repeat,a.setAttribute("aria-label",`Repeat: ${r.repeat}`),C.appendChild(a)}if(c.appendChild(C),t==="edit"){const a=document.createElement("div");a.className="actions";const s=document.createElement("select");for(const u of["none","daily","weekly"]){const m=document.createElement("option");m.value=u,m.textContent=u,u===r.repeat&&(m.selected=!0),s.appendChild(m)}s.setAttribute("aria-label",`Change repeat for: ${r.text}`),s.addEventListener("change",()=>{var m;const u=s.value;(m=e.onBeforeMutate)==null||m.call(e),X(r.id,u)});const h=document.createElement("button");h.className="secondary",h.textContent="Edit",h.setAttribute("aria-label",`Edit todo: ${r.text}`),h.addEventListener("click",()=>{var m;const u=prompt("Edit todo text:",r.text);if(u!=null){const w=u.trim();w&&((m=e.onBeforeMutate)==null||m.call(e),j(r.id,w))}});const E=document.createElement("button");E.className="danger",E.textContent="Delete",E.setAttribute("aria-label",`Delete todo: ${r.text}`),E.addEventListener("click",()=>{var u;confirm("Delete this todo?")&&((u=e.onBeforeMutate)==null||u.call(e),U(r.id))}),a.appendChild(s),a.appendChild(h),a.appendChild(E),c.appendChild(a)}else{const a=document.createElement("div");c.appendChild(a)}return c}}function o(){const i=J(),f=document.getElementById("last-edited");if(!f)return;const l=i.lastEditedAt?z(new Date(i.lastEditedAt)):"Never",N=i.lastEditedAt?` (${K(new Date(i.lastEditedAt),new Date)})`:"";f.textContent=`Last edited at: ${l}${N}`}return{render:d,updateRelativeTimer:o}}window.addEventListener("DOMContentLoaded",()=>{const n=document.getElementById("app");if(!n)return;let e=!1;const t=fe(n,{onBeforeMutate:()=>{e&&(_(new Date),e=!1)}});_(new Date),t.render(),W(()=>t.render()),window.addEventListener("storage",o=>{o.key===$&&Q()});let d=Date.now();setInterval(()=>{const o=Date.now();o-d>6*60*60*1e3&&(e=!0),d=o,t.updateRelativeTimer()},6e4)});
